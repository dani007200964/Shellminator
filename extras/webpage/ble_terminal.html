<!doctype html>
<!--
* Created on Sept 17 2022
*
* Copyright (c) 2022 - Daniel Hajnal
* hajnal.daniel96@gmail.com
* This file is part of the Shellminator project.
* Modified 2024.07.20

MIT License

Copyright (c) 2020 Daniel Hajnal

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->

<html>
    <head>
        <title>Terminal</title>
        <link href="data:image/x-icon;base64,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" rel="icon" type="image/x-icon" />
        <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xterm/xterm@5.5.0/css/xterm.min.css">
        <style>
            .xterm-viewport::-webkit-scrollbar {
                width: 8px;
            }

            .xterm-viewport::-webkit-scrollbar-track {
                border-radius: 4px;
                background-color: #95a5a6;
                border: 1px solid #2c3e50;
            }

            .xterm-viewport::-webkit-scrollbar-thumb {
                background-color: #cacaca;
            }
        </style>

        <script src="https://cdn.jsdelivr.net/npm/@xterm/xterm@5.5.0/lib/xterm.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@xterm/addon-web-links@0.11.0/lib/addon-web-links.min.js"></script>

        <style>
            * { box-sizing: border-box; }

            body {
                margin: 0;
                font-family: Arial, Helvetica, sans-serif;
                min-height:100%;
                background-color: #2e323b;
            }

            html {
                height: 100%;
            }

            .header {
                overflow: hidden;
                background-color: #507bd1;
                padding: 10px 10px;
            }

            .header-right {
                float: right;
                display: flex;
                flex-direction: row;
                flex-wrap: wrap;
                align-items: center;
                justify-content: center;
            }

            .button {
                overflow: hidden;
                border: none;
                background-color: #007AFF;
                color: #ffffff;
                text-align: center;
                margin-left: 30px;
                margin-right: 0px;
                padding-left: 10px;
                padding-right: 10px;
                padding-top: 5px;
                padding-bottom: 5px;
                text-decoration: none;
                font-size: 18px;
                line-height: 20px;
                border-radius: 4px;
            }

            .button-text {
                color: #ffffff;
                text-align: center;
                margin-left: 10px;
            }

            .button:hover {
                background-color: #70b1e9;
            }

            .connected-text {
                position: relative;
                background-color: #438a59;
                color: white;
                font-family: Arial, Helvetica, sans-serif;
                text-align: center;
                font-size: 15px;
                height: 20px;
                opacity: 0.0;
            }

            .ip-text{
                font-family: Arial, Helvetica, sans-serif;
                width: 100%;
                height: 30px;
                margin-left: 20px;
                margin-right: 20px;
                display: inline-block;
                border: 1px solid #ccc;
                border-radius: 4px;
                box-sizing: border-box;
            }

            .footer {
                position: fixed;
                left: 0;
                bottom: 0;
                width: 100%;
                background-color: #252628;
                color: white;
                text-align: center;
                padding: 8px 8px;
            }

            .footer p {
                font-size: 16px;
                display: inline;
            }

            .footer a {
                font-size: 16px;
                text-decoration: none;
                color: #1879C4;
            }

            .footer a.copyright {
                font-size: 16px;
                color:white;
            }

            .speech-bubble {
                background: #FFFFFF;
                color: #34495E;
                padding: 0.7em 1em;
                position: absolute;
                top: 40px;
                left: 30px;
                border-radius: 0 1em 1em 1em;
                box-shadow: 5px 5px 10px #34495E;
                z-index: 3000;
            }

            .boubble-button {
                overflow: hidden;
                background-color: transparent;
                background-repeat: no-repeat;
                border: none;
                cursor: pointer;
                outline: none;
                width: 20px;
                height: 20px;
                text-align: center;
                padding: 0px 0px;
                transition: 0.1s;
                position: absolute;
                right: 5px;
                bottom: 5px;
            }

            .boubble-button:hover {
                transform: rotate(90deg);
                transition: 0.1s;
            }

            .logo-button {
                overflow: hidden;
                background-color: transparent;
                background-repeat: no-repeat;
                border: none;
                cursor: pointer;
                outline: none;
                width: 300px;
                height: 30px;
                padding: 0px 0px;
                filter: drop-shadow( rgba(255, 224, 20, 0.0) 0px 0px 2px );
                transition: 0.5s;
            }

            .logo-button:hover{
                filter: drop-shadow( rgba(0, 247, 255, 0.8) 0px 0px 2px );
            }

            .header::logo-button {
                content: " ";
                display: block;
                position: absolute;
                top: 0;
                left: 0;
                bottom: 0;
                right: 0;
                background: rgba(255, 255, 255, 0.1);
                opacity: 0;
                z-index: 2;
                pointer-events: none;
            }

            ul {
                font-size: 20px;
                position: absolute;
                left: 0;
                top: 50px;
                display: inline-block;
                    text-align: left;
                list-style-position: outside;
            }

            .terminal-container {
                overflow: hidden;
                margin: 0;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate( -50%, -50% );
                box-shadow: 0px 0px 20px #34495E;
                border-radius: 10px;
                width: 90%;
            }
        </style>
    </head>

    <body>
        <div class="header" id="header">
            <button class="logo-button" id="logoButton">
                <img src="logo.svg"/>
            </button>

            <div class="header-right">
                <svg width="30px" height="30px" viewBox="0 0 256 256" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                    <g id="Artboard" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                        <g id="Group">
                            <rect id="Rectangle" fill="#007AFF" x="0" y="0" width="256" height="256" rx="59"></rect>
                            <path d="M116.264618,46 L177.937077,94.2183846 L136.396128,129.39877 L177.526606,164.809487 L116.264618,210.484809 L116.264618,147.718034 L84.6557714,175.581154 L77,167.925382 L116.264618,129.875815 L116.264618,129.566535 L77,90.5106485 L85.7190811,81.6930056 L116.264618,110.783438 L116.264618,46 Z M129.313223,138.213516 L129.313223,186.667464 L156.458082,164.39877 L129.313223,138.213516 Z M129.313223,72.6079979 L129.313223,119.532403 L156.458082,94.3987703 L129.313223,72.6079979 Z" id="Combined-Shape-Copy" fill="#FFFFFF"></path>
                        </g>
                    </g>
                </svg>
                <div><label class="button-text" id="targetInputText">Bluetooth LE</label></div>
                <div><button class="button" type="button" id="openButton">Open</button></div>
            </div>

            <div class="speech-bubble" id="bubbleDiv">
                <p id="bubbleText">Hello</p>
                <button class="boubble-button" type="button" id="boubbleCloseButton">
                    <svg
                        viewBox="0 0 32 32"
                        version="1.1"
                        id="svg3480"
                        inkscape:version="1.2.1 (9c6d41e410, 2022-07-14)"
                        sodipodi:docname="close.svg"
                        xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
                        xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
                        xmlns="http://www.w3.org/2000/svg"
                        xmlns:svg="http://www.w3.org/2000/svg">
                        <sodipodi:namedview
                            id="namedview3482"
                            pagecolor="#ffffff"
                            bordercolor="#666666"
                            borderopacity="1.0"
                            inkscape:showpageshadow="2"
                            inkscape:pageopacity="0.0"
                            inkscape:pagecheckerboard="0"
                            inkscape:deskcolor="#d1d1d1"
                            inkscape:document-units="mm"
                            showgrid="false"
                            inkscape:zoom="4.1776837"
                            inkscape:cx="54.575697"
                            inkscape:cy="64.389748"
                            inkscape:window-width="1920"
                            inkscape:window-height="1009"
                            inkscape:window-x="-8"
                            inkscape:window-y="-8"
                            inkscape:window-maximized="1"
                            inkscape:current-layer="layer1" />
                        <defs
                            id="defs3477" />
                        <g
                            inkscape:label="RÃ©teg 1"
                            inkscape:groupmode="layer"
                            id="layer1">
                            <path
                            id="path4017"
                            style="fill:none;stroke:#34495e;stroke-width:2.11667;stroke-linecap:square;paint-order:markers stroke fill;stroke-opacity:1"
                            d="M 29.25573,16 A 13.25573,13.25573 0 0 1 16,29.25573 13.25573,13.25573 0 0 1 2.7442703,16 13.25573,13.25573 0 0 1 16,2.7442703 13.25573,13.25573 0 0 1 29.25573,16 Z" />
                            <rect
                            style="fill:#34495e;fill-opacity:1;stroke:none;stroke-width:1.32546;stroke-linecap:square;stroke-dasharray:none;stroke-opacity:1;paint-order:markers stroke fill"
                            id="rect4437"
                            width="17.286188"
                            height="2.1495779"
                            x="13.984323"
                            y="-1.074789"
                            transform="rotate(45)" />
                            <rect
                            style="fill:#34495e;fill-opacity:1;stroke:none;stroke-width:1.32546;stroke-linecap:square;stroke-dasharray:none;stroke-opacity:1;paint-order:markers stroke fill"
                            id="rect5271"
                            width="17.286188"
                            height="2.1495779"
                            x="-8.6430941"
                            y="21.552628"
                            transform="rotate(-45)" />
                        </g>
                    </svg>
                </button>
            </div>
        </div>

        <div class="connected-text" id="connectionText">Connected</div>
        <div class="terminal-container" id="terminal"></div>

        <div class="footer" id="footer">
            <p>Powered by
            <a href="https://www.shellminator.org/">Shellminator</a>
            <a class="copyright" title="Daniel Hajnal" href="mailto: hajnal.daniel96@gmail.com">&nbsp;|&nbsp; &copy; 2020-<script>document.write(new Date().getFullYear())</script> Daniel Hajnal </a>
            </p>
        </div>

    </body>
</html>

<script>
    /* Text related objects */
    const bubbleText = document.getElementById("bubbleText");
    const bubbleDiv = document.getElementById("bubbleDiv");
    const targetInputText = document.getElementById( "targetInputText" );

    /* Buttons */
    const boubbleCloseButton = document.getElementById("boubbleCloseButton");
    const logoButton = document.getElementById("logoButton");
    const openButton = document.getElementById("openButton");
    const connectionText = document.getElementById("connectionText");

    /* Input */
    const targetInput = document.getElementById( "targetInput" );

    /* URL Arguments */
    const queryString = window.location.search;
    const urlParams = new URLSearchParams( queryString );
    const urlAutoConnect = urlParams.get( 'autoConnect' );
    const urlTargetIP = urlParams.get( 'targetIP' );
    const urlTargetPort = urlParams.get( 'targetPort' );
    const urlSelfHosted = urlParams.get( 'selfHosted' );

    var targetIP = "";
    var targetPort = "443";

    /* Show - hide states */
    var showBoubble = false;

    /* Arnold's best lines */
    const famousQuotes = [
    "Hasta la vista, baby!",
    "Come with me if you want to live",
    "I like this car",
    "I don't know how much longer I can hold this",
    "I need your clothes, your boots, and your motorcycle",
    "I'll be back"
    ];

    /* Stores the previously generated quote index */
    var prevQuoteID = -1;

    /* At startup we have to hide the popups */
    bubbleDiv.style.display = "none";

    /* Logo click event */
    logoButton.addEventListener( "click", () => {
        /* Calculate random index for famousQuotes */
        var quoteID = Math.floor( Math.random() * famousQuotes.length );

        /* If prevQuoteID is greater than zero, that means an ID was generated since the page is loaded */
        if( prevQuoteID >= 0 ){
            /* This setion doesn't allow a quote to be appear twice in a row */
            while( quoteID == prevQuoteID ){
            quoteID = Math.floor( Math.random() * famousQuotes.length );
            }
        }

        /* Save the new ID and set it to the textbox */
        prevQuoteID = quoteID;
        bubbleText.innerHTML = famousQuotes[ quoteID ];

        /* If the textbox was hidden, make it visible */
        if( showBoubble == false ){

            bubbleDiv.style.display = "block";
            showBoubble = true;

        }
    });

    /* Quote box close click event */
    boubbleCloseButton.addEventListener( "click", () => {
        /* Hide the quote text box */
        bubbleDiv.style.display = "none";
        showBoubble = false;
    });

    /* Reconnect button click event */
    openButton.addEventListener( "click", () => {
        if( connectionState !== connectionState_t.Connected ){
            console.log( "Connect Button!" );
            connectToBLE();
        }

        else{
            console.log( "Disconnect Button!" );
            disconnectBLE();
        }
    });

    /* Original source: https://www.nordtheme.com/ */
    let nord0  = '#2E3440';
    let nord1  = '#3B4252';
    let nord2  = '#434C5E';
    let nord3  = '#4C566A';
    let nord4  = '#D8DEE9';
    let nord5  = '#E5E9F0';
    let nord6  = '#ECEFF4';
    let nord7  = '#8FBCBB';
    let nord8  = '#88C0D0';
    let nord9  = '#81A1C1';
    let nord10 = '#5E81AC';
    let nord11 = '#BF616A';
    let nord12 = '#D08770';
    let nord13 = '#EBCB8B';
    let nord14 = '#A3BE8C';
    let nord15 = '#B48EAD';

    var theme = {
        foreground: nord4,
        background: nord0,
        cursor:     nord4,

        black: nord2,
        brightBlack: nord1,

        red: nord12,
        brightRed: nord11,

        green: nord7,
        brightGreen: nord14,

        yellow: nord13,
        brightYellow: nord13,

        blue: nord5,
        brightBlue: nord8,

        magenta: nord11,
        brightMagenta: nord15,

        cyan: nord5,
        brightCyan: nord8,

        white: nord4,
        brightWhite: nord5
    };

    /* Create a new xTerm object */
    const term = new Terminal({
        fontFamily: '"andale mono", monospace',
        cursorBliknk: "true",
        cursorStyle: "block",
        theme: theme,
    });

    const attachAddon = new WebLinksAddon.WebLinksAddon();
    term.loadAddon( attachAddon );

    /* Set the font size of the terminal */
    var terminalFontSize = 20;

    /* Open terminal object */
    term.open(document.getElementById('terminal'));


    /* Object for time data */
    var time = new Date();

    /* Websocket open event */
    function bleConnectEvent(){
        /* Print the event to the terminal with a timestamp */
        /* Because minifiaction every escaped seqneche has to be replaced with String.fromCharCode() Why God, Why???? */
        var eventTime = "[ " + String.fromCharCode( 27 ) + "[1;32m" + time.getHours() + ":" + time.getMinutes() + ":" + time.getSeconds() + String.fromCharCode( 27 ) + "[0;37m ] ";
        console.log( "BLE Device Connected!" );
        term.write( eventTime + " BLE Device Connected!" + String.fromCharCode( 13, 10 ) ); // this uglyness ads \r\n to the end
        openButton.innerText = 'Close';
        connectionText.innerText = 'Connected';
        connectionText.style.opacity = 1.0;
        connectionText.style.backgroundColor = '#438a59';

        /* Hide the reconnect popup, save flag */
        connectionState = connectionState_t.Connected;
    }

    /* Websocket close event */
    function bleCloseEvent(){
        /* Print the event to the terminal with a timestamp */
        var eventTime = "";

        /* If it's the first message related to connection status, start it with new line for formatting */
        if( connectionState === connectionState_t.Connected ){
            eventTime += String.fromCharCode( 13, 10 );
        }

        /* Save flag */
        connectionState = connectionState_t.Disconnected;
        openButton.innerText = 'Open';
        connectionText.style.opacity = 1.0;
        connectionText.style.backgroundColor = '#75070f';

        eventTime += "[ " +  String.fromCharCode( 27 ) + "[1;31m" + time.getHours() + ":" + time.getMinutes() + ":" + time.getSeconds() + String.fromCharCode( 27 ) + "[0;37m ] ";

        console.log( "BLE Device Disconected!" );
        term.write( eventTime + " BLE Device Disconected!" + String.fromCharCode( 13, 10 ) );
        connectionText.innerText = 'Disconnected';
    }

    let unicodeBuffer = new Uint8Array( 3 );
    let unicodeBufferCounter = 0;

    /* Websocket message event */
    function bleOnMessageEvent( e ){
        let decoder = new TextDecoder( 'utf-8' );
        let data = e.target.value;
        let dataLength = data.byteLength;
        console.log( data );
        //let string = [];

        /* Just push the data to the terminal screen */
        /*
        for( let i = 0; i < data.byteLength; i++ ){
            //string.push( String.fromCharCode( data.getUint8(i) ) );
            term.write( String.fromCharCode( data.getUint8(i) ) );
        }
        */

        console.log( decoder.decode( data.buffer ) );
        term.write( decoder.decode( data.buffer ) );
        
    }

    function webSocketErrorEvent( e ){
        console.log( e );
    }

    /* Websocket object and connection flag */
    var ws;

    const connectionState_t = {
        Searching: 0,
        Connected: 1,
        Canceled: 2,
        ConnectionFailed: 3
    };

    var connectionState = connectionState_t.Searching;
    let rxChannel;
    let txChannel;
    var bleDevice = null;

    function disconnectBLE(){
        if(!bleDevice){
            return;
        }
        if( bleDevice.gatt.connected ){
            bleDevice.gatt.disconnect();
        }
        else{
            console.log( "Bluetooth Device is already disconnected" );
        }
    }

    /* This function has to be called, when we want to connect to the websocket */
    async function connectToBLE(){
        const bleUartServiceUUID = "6e400001-b5a3-f393-e0a9-e50e24dcca9e";
        const bleUartRxCharacteristicsUUID = '6e400003-b5a3-f393-e0a9-e50e24dcca9e';
        const bleUartTxCharacteristicsUUID = '6e400002-b5a3-f393-e0a9-e50e24dcca9e';

        /*
        
        navigator.bluetooth.requestDevice({
            acceptAllDevices: true
        }).then( device => {
            console.log( 'Connecting to GATT Server...' );
            return device.gatt.connect();
        } );
        */
        connectionState = connectionState_t.Searching;
        try {
            bleDevice = await navigator.bluetooth.requestDevice({
                filters:[{
                    name: 'Shellminator BLE UART'
                    
                }],
                optionalServices: [ bleUartServiceUUID ]
            });
            bleDevice.addEventListener( 'gattserverdisconnected', bleCloseEvent );
            const connectedDevice = await bleDevice.gatt.connect();

            const uartServices = await connectedDevice.getPrimaryServices( [ bleUartServiceUUID ] );
            console.log( 'Uart Service Found.' );
            console.log( uartServices[ 0 ].uuid );

            const uartCharacteristics = await uartServices[ 0 ].getCharacteristics();
            console.log( 'Characteristics Found.' );
            console.log( uartCharacteristics );

            if( uartCharacteristics[ 0 ].uuid === bleUartRxCharacteristicsUUID ){
                rxChannel = uartCharacteristics[ 0 ];
                txChannel = uartCharacteristics[ 1 ];
            }
            else{
                rxChannel = uartCharacteristics[ 1 ];
                txChannel = uartCharacteristics[ 0 ];
            }

            await rxChannel.startNotifications();
            rxChannel.addEventListener( 'characteristicvaluechanged', bleOnMessageEvent );

            bleConnectEvent();
        }
        catch{
            if( typeof device !== 'undefined' ){
                connectionState = connectionState_t.ConnectionFailed;
                console.log( "Connection Failed!" );
            }
            else{
                connectionState = connectionState_t.Canceled;
                console.log( "Connection Canceled!" );
            }
        }
        
    }

    let bleTransmittInProgress = false;
    let bleTransmittBuffer = '';
    let bleTransmittBufferIdx = 1;

    /* Every time when a key is pressed in the terminal this callback will be called */
    term.onData( data => {
        /* If connected, send the data to the websocket */
        if( connectionState === connectionState_t.Connected ){
            bleTransmittBuffer = bleTransmittBuffer + data;
        }
    } );

    function sendTxData(){
        if( connectionState === connectionState_t.Connected ){
            if( !bleTransmittInProgress ){
                if( bleTransmittBuffer.length > 0 ){
                    let sendBuffer = bleTransmittBuffer;
                    bleTransmittBuffer = '';
                    console.log( "BLE Send Event!" );
                    console.log( '> ' + sendBuffer );

                    let encoder = new TextEncoder( 'utf-8' );
                    bleTransmittInProgress = true;
                    txChannel.writeValue( encoder.encode( sendBuffer ) ).then( _ => {
                        bleTransmittInProgress = false;
                    } );
                }
            }
        }
    }

    setInterval( sendTxData, 100 );

    // After page load
    if( urlTargetPort != null ){
        const portPattern = /\b(0|[1-9][0-9]{0,3}|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-5])$/;
        if( portPattern.test( urlTargetPort ) ){
            console.log( 'Target Port defined pre-defined as: ' + urlTargetPort );
            targetPort = urlTargetPort;
        }
        else{
            console.log( 'Target Port defined, but invalid!' );
        }
    }

    if( urlTargetIP != null ){
        const ipv4Pattern = /\b([01]?[0-9][0-9]?|2[0-4][0-9]|25[0-5]).\b([01]?[0-9][0-9]?|2[0-4][0-9]|25[0-5]).\b([01]?[0-9][0-9]?|2[0-4][0-9]|25[0-5]).\b([01]?[0-9][0-9]?|2[0-4][0-9]|25[0-5])/;
        if( ipv4Pattern.test( urlTargetIP ) ){
            console.log( 'Target IP defined pre-defined as: ' + urlTargetIP );
            targetIP = urlTargetIP;

            targetInput.value = "ws://" + targetIP + ":" + targetPort;
            if( urlAutoConnect != null ){
                connectToWebSocket();
            }

        }
        else{
            console.log( 'Target IP defined, but invalid!' );
        }    
    }

    if( urlSelfHosted != null ){
        if( urlTargetPort == null ){
            console.log( "Port not specified! Default port is used, which is 443" );
        }
        targetInput.style.display = 'none';
        targetInputText.style.display = 'none';
        if( urlAutoConnect != null ){
            connectToWebSocket();
        }
    }
    // todo: make it work like tha same as the offline version.
</script>
